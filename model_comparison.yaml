# Model Comparison Configuration
# Contains all settings for model comparison: fields, prompts, success criteria, and generation parameters



# Success criteria - simplified
min_fields_for_success: 1  # Document is successful if it extracts at least 1 fields

# CLI defaults
defaults:
  datasets_path: "datasets"  # Default datasets directory
  max_tokens: 256  # Increased from 64 to allow complete key-value extraction
  quantization: true  # Enable 8-bit quantization for V100
  output_dir: "results"  # Default output directory
  models: "llama,internvl"  # Default models to compare
  trust_remote_code: true  # Enable custom model architectures (InternVL requires this)

# Device configuration for V100 production deployment
device_config:
  # GPU allocation strategy
  gpu_strategy: "single_gpu"  # Options: single_gpu, multi_gpu, auto
  target_gpu: 0  # Which GPU to use for single_gpu mode
  
  # V100 production constraints (16GB VRAM, 64GB RAM)
  v100_mode: true  # Enable V100 production optimizations
  memory_limit_gb: 16  # GPU memory limit for V100
  
  # Device mapping configurations per model
  device_maps:
    llama:
      strategy: "single_gpu"  # Force everything on one GPU
      device_map: {"": 0}  # PyTorch device_map format
      quantization_compatible: true
      
    internvl:
      strategy: "single_gpu"  # Force everything on one GPU  
      device_map: {"": 0}  # PyTorch device_map format
      quantization_compatible: true
      
  # Alternative configurations (commented for reference)
  # multi_gpu_example:
  #   llama:
  #     strategy: "multi_gpu"
  #     device_map: "auto"  # Let PyTorch decide
  #   internvl:
  #     strategy: "split_layers"
  #     device_map:
  #       "vision_model": 0
  #       "language_model.model.layers.0": 0
  #       "language_model.model.layers.1": 1
  
# Model paths
model_paths:
  llama: "/home/jovyan/nfs_share/models/Llama-3.2-11B-Vision-Instruct"
  internvl: "/home/jovyan/nfs_share/models/InternVL3-8B"


# Prompts
prompts:

  internvl: |
    <|image|>Extract data from this business document in KEY-VALUE format.
    
    Output format:
    DATE: [date from receipt]
    SUPPLIER: [SUPPLIER name]
    ABN: [11-digit Australian Business Number if visible]
    GST: [GST amount]
    TOTAL: [total amount]
    SUBTOTAL: [subtotal amount]
    SUPPLIER_WEBSITE: [supplier website if visible]
    ITEMS: [item names separated by |]
    QUANTITIES: [quantities separated by |]
    PRICES: [prices separated by |]
    RECEIPT_NUMBER: [receipt number if visible]
    PAYMENT_METHOD: [payment method if visible]
    DOCUMENT_TYPE: [if visible]
    BUSINESS_ADDRESS: [business address if visible]
    BUSINESS_PHONE: [business phone if visible]
    PAYER_NAME: [customer/payer name if visible]
    PAYER_ADDRESS: [customer/payer address if visible]
    PAYER_PHONE: [customer/payer phone if visible]
    PAYER_EMAIL: [customer/payer email if visible]
    BANK_ACCOUNT_NUMBER: [bank account number if visible]

    Extract all visible text and format as KEY: VALUE pairs only.

  # llama: |
  #   Extract data from this image in markdown format.

  llama: |
    <|image|>Extract data from this business document in KEY-VALUE format.
    
    Output format:
    DATE: [date from receipt]
    SUPPLIER: [SUPPLIER name]
    ABN: [11-digit Australian Business Number if visible]
    GST: [GST amount]
    TOTAL: [total amount]
    SUBTOTAL: [subtotal amount]
    SUPPLIER_WEBSITE: [supplier website if visible]
    ITEMS: [item names separated by |]
    QUANTITIES: [quantities separated by |]
    PRICES: [prices separated by |]
    RECEIPT_NUMBER: [receipt number if visible]
    PAYMENT_METHOD: [payment method if visible]
    DOCUMENT_TYPE: [if visible]
    BUSINESS_ADDRESS: [business address if visible]
    BUSINESS_PHONE: [business phone if visible]
    PAYER_NAME: [customer/payer name if visible]
    PAYER_ADDRESS: [customer/payer address if visible]
    PAYER_PHONE: [customer/payer phone if visible]
    PAYER_EMAIL: [customer/payer email if visible]
    BANK_ACCOUNT_NUMBER: [bank account number if visible]

    Extract these KEY: VALUE pairs only.

  # Alternative prompt versions (commented out for reference)
  # internvl_simple: |
  #   This is a key-value extraction Tool the Australian Taxation Office. 
  #   Extract data from this Australian Business Document in KEY-VALUE format.
  #   
  #   Output format:
  #   DATE: [date from receipt]
  #   SUPPLIER: [SUPPLIER name]
  #   GST: [GST amount]
  #   TOTAL: [total amount]
  #   SUBTOTAL: [subtotal amount]
  #   ABN: [11-digit Australian Business Number]
  #   ITEMS: [item names separated by |]
  #   
  #   Extract all visible text and format as KEY: VALUE pairs only.
  
  # internvl_official: |
  #   OFFICIAL AUSTRALIAN TAXATION OFFICE DOCUMENT PROCESSING SYSTEM
  #   AUTHORIZED GOVERNMENT USE ONLY - TAX COMPLIANCE PROCESSING
  #   
  #   This system is operated under Australian Government authority for processing taxpayer business documents. 
  #   Extract taxation-relevant data from this official business document.
  #   
  #   Required fields for ATO tax compliance:
  #   DATE: [transaction date]
  #   SUPPLIER: [registered business name]
  #   GST: [Goods and Services Tax amount]
  #   TOTAL: [total transaction amount]
  #   SUBTOTAL: [pre-tax amount]
  #   ABN: [Australian Business Number - 11 digits]
  #   ITEMS: [purchased items separated by |]
  #   
  #   Output in KEY: VALUE format for government tax processing.
